input {
  tcp {
    port => 5000
    codec => json_lines
  }

  udp {
    port => 5000
    codec => json_lines
  }

  # File input for log files
  file {
    path => "/usr/share/logstash/logs/sagaline-json.log"
    start_position => "beginning"
    codec => json
  }
}

filter {
  # Parse timestamp
  date {
    match => ["timestamp", "ISO8601"]
    target => "@timestamp"
  }

  # Add geoip if needed
  if [clientIp] {
    geoip {
      source => "clientIp"
    }
  }

  # Parse user agent if available
  if [userAgent] {
    useragent {
      source => "userAgent"
      target => "user_agent"
    }
  }

  # Add environment tag
  mutate {
    add_field => { "environment" => "${ENVIRONMENT:dev}" }
  }
}

output {
  elasticsearch {
    hosts => ["elasticsearch:9200"]
    index => "sagaline-logs-%{+YYYY.MM.dd}"
  }

  # Debug output (remove in production)
  stdout {
    codec => rubydebug
  }
}
